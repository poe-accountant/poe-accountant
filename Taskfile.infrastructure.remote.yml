version: '3'

tasks:
  create:
    desc: Create the complete remote infrastructure (Terraform apply + kubectl setup)
    cmds:
      - |
        echo "ğŸš€ Creating remote infrastructure..."
        echo ""
        echo "ğŸ“‹ Step 1: Applying Terraform configuration..."
      - task: infrastructure:terraform:apply
      - |
        echo ""
        echo "âš¡ Step 2: Configuring kubectl..."
      - task: infrastructure:k8s:setup-remote
      - |
        echo ""
        echo "âœ… Remote infrastructure created and configured!"
        echo "ğŸ” Verifying cluster connection..."
      - task: infrastructure:k8s:info

  setup:
    desc: Setup connection to existing remote infrastructure
    cmds:
      - echo "ğŸ”§ Setting up connection to remote infrastructure..."
      - echo ""
      - echo "ğŸ“‹ Configuring kubectl..."
      - task: infrastructure:k8s:setup-remote
      - echo ""
      - echo "âœ… Remote infrastructure connection configured!"
      - echo "ğŸ” Verifying cluster connection..."
      - task: infrastructure:k8s:info

  plan:
    desc: Plan the remote infrastructure changes
    cmds:
      - echo "ğŸ“‹ Planning remote infrastructure changes..."
      - task: infrastructure:terraform:plan

  destroy:
    desc: Destroy the complete remote infrastructure
    prompt: Are you sure you want to DESTROY all remote infrastructure?
    cmds:
      - echo "ğŸ’¥ Destroying remote infrastructure..."
      - echo ""
      - echo "âš ï¸  This will destroy:"
      - echo "   â€¢ Kubernetes cluster and all workloads"
      - echo "   â€¢ PostgreSQL database and all data"
      - echo "   â€¢ Redis instance and all data"
      - echo ""
      - task: infrastructure:terraform:destroy
      - echo ""
      - echo "ğŸ’€ Remote infrastructure destroyed!"

  status:
    desc: Show status of remote infrastructure
    cmds:
      - echo "ğŸ“Š Remote Infrastructure Status"
      - echo "==============================="
      - echo ""
      - echo "ğŸ—ï¸  Terraform Resources:"
      - task: infrastructure:terraform:show
      - echo ""
      - echo "â˜¸ï¸  Kubernetes Cluster:"
      - task: infrastructure:k8s:info

  outputs:
    desc: Show remote infrastructure outputs
    cmds:
      - echo "ğŸ“‹ Remote Infrastructure Outputs"
      - echo "================================="
      - task: infrastructure:terraform:output

  validate:
    desc: Validate remote infrastructure configuration
    cmds:
      - echo "âœ… Validating remote infrastructure..."
      - echo ""
      - echo "ğŸ” Terraform validation:"
      - task: infrastructure:terraform:validate
      - echo ""
      - echo "ğŸ” Terraform format check:"
      - task: infrastructure:terraform:format:check
      - echo ""
      - echo "âœ… Remote infrastructure validation complete!"

  refresh:
    desc: Refresh remote infrastructure state
    cmds:
      - echo "ğŸ”„ Refreshing remote infrastructure state..."
      - task: infrastructure:terraform:refresh
      - echo ""
      - echo "âœ… Remote infrastructure state refreshed!"

  backup-config:
    desc: Backup remote infrastructure configuration
    cmds:
      - echo "ğŸ’¾ Backing up remote infrastructure configuration..."
      - mkdir -p backups
      - cp -r infrastructure/ backups/infrastructure-$(date +%Y%m%d-%H%M%S)/
      - echo "âœ… Configuration backed up to backups/ directory"
