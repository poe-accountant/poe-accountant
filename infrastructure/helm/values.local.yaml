# Global configuration
global:
  namespace: poe-accountant

# Docker registry configuration
docker:
  registry: ""  # Leave empty for local Docker Desktop registry, or set to your registry (e.g., docker.io, ghcr.io, localhost:5000)

# Services configuration - each service defines its ingress path
services:
  # Example service configuration:
  ninja-server:
    enabled: true
    scaling:
      minReplicas: 1 # required, the amount of replicas to start with (no autoscaling if the rest aren't set)
      maxReplicas: 2 # optional
      targetCPUUtilizationPercentage: 80
    image:
      repository: poe-accountant-ninja-server
      tag: latest
      pullPolicy: IfNotPresent
    ports:
      - containerPort: 3000
        name: http # required for ingress
        servicePort: 80  # Optional: defaults to containerPort
    # Service configuration
    ingress:
      path: /api
      healthCheck: /health
    env:
      NODE_ENV: production
      PORT: "3000"
    # envSecretName: ninja-server-secret
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
    securityContext:
      allowPrivilegeEscalation: false
      runAsNonRoot: true
      runAsUser: 1000
      capabilities:
        drop:
          - ALL

# Ingress configuration
ingress:
  # Main host configuration
  host: localhost
  
  # TLS configuration (optional)
  # tlsSecretName: site-tls

# NGINX Ingress Controller configuration
ingress-nginx:
  enabled: true
  controller:
    service:
      type: NodePort
      nodePorts:
        http: 30080
        https: 30443
    # Configure for local development
    config:
      use-forwarded-headers: "true"
      # Allow access without host header for testing
      enable-real-ip: "true"
    # Allow scheduling on control plane for local development
    tolerations:
      - key: node-role.kubernetes.io/control-plane
        operator: Equal
        effect: NoSchedule
      - key: node-role.kubernetes.io/master
        operator: Equal
        effect: NoSchedule
